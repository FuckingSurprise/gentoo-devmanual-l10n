<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Mirrors – Gentoo Development Guide</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="The Gentoo Devmanual is a technical manual which covers topics such as writing ebuilds and eclasses, and policies that developers should be abiding by.">
<link href="/assets.gentoo.org/tyrian/bootstrap.min.css" rel="stylesheet" media="screen">
<link href="/assets.gentoo.org/tyrian/tyrian.min.css" rel="stylesheet" media="screen">
<link rel="stylesheet" href="../../devmanual.css" type="text/css">
<link rel="icon" href="/www.gentoo.org/favicon.ico" type="image/x-icon">
</head>
<body>
<header><div class="site-title"><div class="container"><div class="row">
<div class="site-title-buttons"><div class="btn-group btn-group-sm">
<a href="https://get.gentoo.org/" role="button" class="btn get-gentoo"><span class="fa fa-fw fa-download"></span><strong> Get Gentoo!</strong></a><div class="btn-group btn-group-sm">
<a class="btn gentoo-org-sites dropdown-toggle" data-toggle="dropdown" data-target="#" href="index.html#"><span class="fa fa-fw fa-map-o"></span><span class="hidden-xs"> gentoo.org sites </span><span class="caret"></span></a><ul class="dropdown-menu dropdown-menu-right">
<li><a href="https://www.gentoo.org/" title="Main Gentoo website"><span class="fa fa-home fa-fw"></span> gentoo.org</a></li>
<li><a href="https://wiki.gentoo.org/" title="Find and contribute documentation"><span class="fa fa-file-text-o fa-fw"></span> Wiki</a></li>
<li><a href="https://bugs.gentoo.org/" title="Report issues and find common issues"><span class="fa fa-bug fa-fw"></span> Bugs</a></li>
<li><a href="https://forums.gentoo.org/" title="Discuss with the community"><span class="fa fa-comments-o fa-fw"></span> Forums</a></li>
<li><a href="https://packages.gentoo.org/" title="Find software for your Gentoo"><span class="fa fa-hdd-o fa-fw"></span> Packages</a></li>
<li class="divider">
<li><a href="https://planet.gentoo.org/" title="Find out what's going on in the developer community"><span class="fa fa-rss fa-fw"></span> Planet</a></li>
<li><a href="https://archives.gentoo.org/" title="Read up on past discussions"><span class="fa fa-archive fa-fw"></span> Archives</a></li>
<li><a href="https://sources.gentoo.org/" title="Browse our source code"><span class="fa fa-code fa-fw"></span> Sources</a></li>
<li class="divider">
<li><a href="https://infra-status.gentoo.org/" title="Get updates on the services provided by Gentoo"><span class="fa fa-server fa-fw"></span> Infra Status</a></li>
</ul>
</div>
</div></div>
<div>
<a href="../../index.html" title="Back to the homepage" class="site-logo"><object data="/assets.gentoo.org/tyrian/site-logo.svg" type="image/svg+xml"><img src="/assets.gentoo.org/tyrian/site-logo.png" alt="Gentoo Linux Logo"></object></a><span class="site-label">Development Guide</span>
</div>
</div></div></div>
<nav class="tyrian-navbar" role="navigation"><div class="container"><div class="row">
<div class="navbar-header"><button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-main-collapse"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button></div>
<div class="collapse navbar-collapse navbar-main-collapse"><ul class="nav navbar-nav">
<li><a href="../../index.html"><span class="fa fa-home"></span> Home</a></li>
<li class="dropdown">
<a href="index.html#" class="dropdown-toggle" data-toggle="dropdown">Index <span class="caret"></span></a><ul class="dropdown-menu">
<li><a class="reference" href="index.html#automatic-mirroring">Automatic Mirroring</a></li>
<li><a class="reference" href="index.html#gentoo-mirrors">Gentoo Mirrors</a></li>
<li><a class="reference" href="index.html#mirroring-process">Mirroring Process</a></li>
<li><a class="reference" href="index.html#third-party-mirrors">Third-party mirrors</a></li>
</ul>
</li>
<li><a class="w-250 text-center" href="../manifest/index.html"><span class="fa fa-arrow-left"></span><span class="truncated-text d-inline-block max-w-200 ml-2">Manifest</span></a></li>
<li><a class="w-250 text-center" href="../news/index.html"><span class="truncated-text d-inline-block max-w-200 mr-2">News Items</span><span class="fa fa-arrow-right"></span></a></li>
</ul></div>
</div></div></nav><nav class="navbar navbar-grey navbar-stick" id="devmanual-actions" role="navigation"><div class="container"><div class="row"><div class="input-group">
<input type="search" name="search" placeholder="Search" title="Search Gentoo Developer Manual [f]" accesskey="f" id="searchInput" class="form-control" onclick="fetchDocuments()"><div class="input-group-btn"><input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton btn btn-default" onclick="search()"></div>
</div></div></div></nav><div id="searchResults" class="modal fade" role="dialog"><div class="modal-dialog"><div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal">x</button><h4 class="modal-title">Search Results</h4>
</div>
<div class="modal-body"><p>No results found.</p></div>
<div class="modal-footer"><button type="button" class="btn btn-default" data-dismiss="modal">Close</button></div>
</div></div></div>
<div class="container"><div class="row"><div class="col-md010"><ol class="breadcrumb">
<li><a href="../../index.html">Master Index</a></li>
<li><a href="../index.html">General Concepts</a></li>
</ol></div></div></div></header><main><div class="container">
<h1 class="first-header">Mirrors</h1>
<div class="section">
<h2 id="automatic-mirroring">Automatic Mirroring</h2>
<p>
Packages will automatically have their <code class="docutils literal"><span class="pre">SRC_URI</span></code> components mirrored onto
Gentoo mirrors, including those hosted on the official Gentoo
Infrastructure (i.e. developer space at <code class="docutils literal"><span class="pre">dev.gentoo.org</span></code>). When
fetching, package manager checks
Gentoo mirrors first before trying the original upstream location.
</p>

<p>
This is generally desired behaviour — upstream mirrors are prone to being
rearranged, tidied out or having files modified.
</p>
<div class="section">
<h3 id="restricting-automatic-mirroring">Restricting Automatic Mirroring</h3>
<p>
Three <code class="docutils literal"><span class="pre">RESTRICT</span></code> keywords can be used to control the mirroring process.
</p>

<p>
The <code class="docutils literal"><span class="pre">RESTRICT="mirror"</span></code> setting should be used if we cannot legally mirror
certain files; files will still be downloaded from the original locations.
</p>

<p>
The <code class="docutils literal"><span class="pre">RESTRICT="primaryuri"</span></code> setting causes Portage to try
original locations <i>first</i>, and then fall back to mirrors if necessary.
This should not be used in new ebuilds.
</p>

<p>
There is also <code class="docutils literal"><span class="pre">RESTRICT="fetch"</span></code>, which prevents Portage from trying to
fetch anything manually. The <a class="" href="../../ebuild-writing/functions/pkg_nofetch/index.html">
pkg_nofetch</a> function will be called if any <code class="docutils literal"><span class="pre">SRC_URI</span></code> components cannot be
found. This should only be used if a license requires it.
</p>
</div>
<div class="section">
<h3 id="replacing-automatically-mirrored-files">Replacing Automatically Mirrored Files</h3>
<p>
On rare occasions you may need to replace a file that is already mirrored.
This is usually the case when upstream remakes a release package. If this
is necessary, please use <code class="docutils literal"><span class="pre">SRC_URI</span></code> arrow to rename the file. For example:
</p>

<pre><span class="Constant"><span xmlns="http://www.w3.org/1999/xhtml" class="Comment">#</span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment"> </span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment">upstream</span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment"> </span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment">updated</span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment"> </span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment">the</span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment"> </span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment">distfile</span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment"> </span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment">in</span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment"> </span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment">place,</span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment"> </span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment">so</span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment"> </span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment">suffix</span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment"> </span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment">it</span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment"> </span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment">with</span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment"> </span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment">_YYYYMMDD</span>
<span xmlns="http://www.w3.org/1999/xhtml" class="Identifier">SRC_URI</span><span xmlns="http://www.w3.org/1999/xhtml" class="Constant">=</span><span xmlns="http://www.w3.org/1999/xhtml" class="Statement">"</span>https://example.com/badupstream/<span xmlns="http://www.w3.org/1999/xhtml" class="Identifier">${P}</span>.tar.gz -&gt; <span xmlns="http://www.w3.org/1999/xhtml" class="Identifier">${P}</span>_20191016.tar.gz<span xmlns="http://www.w3.org/1999/xhtml" class="Statement">"</span>
</span></pre>

<p>
Since Gentoo mirrors operate using local distfile names, they will automatically
fetch and start distributing the new version.
</p>

<p>
Please note that if upstream made any changes affecting the built
package, you need to also bump the ebuild's revision. Finally,
remember to remove the ebuilds that are associated with the old
distfile, or regenerate their checksums in <code class="docutils literal"><span class="pre">Manifest</span></code>, if there
are any. This is necessary because these ebuilds will cause checksum
mismatch errors as the checksum recorded in the Manifest file no
longer matches the computed checksum of the fetched distfile.
</p>

<p>
More general information about the internals of mirroring can be found on <a class="" href="https://wiki.gentoo.org/wiki/Project:Infrastructure/Mirrors/Distfile_Mirroring_System">
Infrastructure project's Distfile Mirroring System page</a>.
</p>
</div>
<div class="section">
<h3 id="suitable-download-hosts">Suitable Download Hosts</h3>
<p>
If you have to host a source file (patch or tarball) yourself, as long as it
can be freely distributed (by license and legality), you're suggested to use
your developer's space at <code class="docutils literal"><span class="pre">dev.gentoo.org</span></code>. Since external overlays may
depend on your patches/tarballs, using the dev space at <code class="docutils literal"><span class="pre">dev.gentoo.org</span></code>
keeps the distfiles at a stable and reliable infrastructure. If you retire,
other developers can take over your distfiles and place them into their own
devspace.
</p>

<p>
Previous policy was to use <code class="docutils literal"><span class="pre">mirror://gentoo</span></code> directly, but this is now deprecated, as that
wouldn't allow to have long-term availability and traceability of the source files, which might be a
requirement of the license.
</p>

<p>
When you upload the file to <code class="docutils literal"><span class="pre">dev.gentoo.org:~/public_html</span></code>, you must ensure that it, and its
parent directories, are world-readable. An example <code class="docutils literal"><span class="pre">SRC_URI</span></code> referencing
a distfile mirrored this way is as follows:
</p>

<pre><span class="Constant"><span xmlns="http://www.w3.org/1999/xhtml" class="Identifier">SRC_URI</span><span xmlns="http://www.w3.org/1999/xhtml" class="Constant">=</span><span xmlns="http://www.w3.org/1999/xhtml" class="Statement">"</span>https://dev.gentoo.org/~myname/distfiles/<span xmlns="http://www.w3.org/1999/xhtml" class="Identifier">${P}</span>.tar.gz<span xmlns="http://www.w3.org/1999/xhtml" class="Statement">"</span>
</span></pre>

<p>
where <code class="docutils literal"><span class="pre">myname</span></code> refers to the username of the developer.
</p>

</div>
</div>
<div class="section">
<h2 id="gentoo-mirrors">Gentoo Mirrors</h2>
<p>
To manually upload a file to <code class="docutils literal"><span class="pre">mirror://gentoo</span></code>, <code class="docutils literal"><span class="pre">scp</span></code> it to
<code class="docutils literal"><span class="pre">dev.gentoo.org:/space/distfiles-local</span></code>. The file should appear
on the mirrors within four hours (note that this is <i>less
frequent</i> than <a class="" href="../git-to-rsync/index.html">Git to RSYNC</a>).

If the upstream download location for a package uses a non-standard TCP port
(anything other than 21, 80 or 443), you <i>must</i> manually mirror the files. Not
doing so can cause all kinds of problems with strict firewalls.
</p>
</div>
<div class="section">
<h2 id="mirroring-process">Mirroring Process</h2>
<div class="figure">
<div class="image"><img alt="Mirroring Process" src="diagram.png"></div>
<p class="caption">Diagram showing the mirroring process.</p>
</div>
</div>
<div class="section">
<h2 id="third-party-mirrors">Third-party mirrors</h2>
    <p>
      Usage of third-party mirrors and the <code class="docutils literal"><span class="pre">mirror://</span></code>
      pseudo-protocol is described in the
      <a class="" href="../../ebuild-writing/variables/index.html#third-party-mirrors">SRC_URI
      variable documentation</a>.
    </p>
  </div>
</div></main><footer><div class="container">
<div class="row">
<div class="col-xs-12 col-md-offset-2 col-md-7"></div>
<div class="col-xs-12 col-md-3">
<h3 class="footerhead">Questions or comments?</h3>
                Please feel free to <a href="https://www.gentoo.org/inside-gentoo/contact/">contact us</a>.
              </div>
</div>
<div class="row">
<div class="col-xs-2 col-sm-3 col-md-2"><ul class="footerlinks three-icons">
<li><a href="https://twitter.com/gentoo" title="@Gentoo on Twitter"><span class="fa fa-twitter fa-fw"></span></a></li>
<li><a href="https://www.facebook.com/gentoo.org" title="Gentoo on Facebook"><span class="fa fa-facebook fa-fw"></span></a></li>
</ul></div>
<div class="col-xs-10 col-sm-9 col-md-10">
<strong>Copyright (C) 2001-2021 Gentoo Authors</strong><br><small>
                Gentoo is a trademark of the Gentoo Foundation, Inc.
                The text of this document is distributed under the
                <a href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.
                The <a href="https://www.gentoo.org/inside-gentoo/foundation/name-logo-guidelines.html">Gentoo Name and Logo Usage Guidelines</a> apply.
              </small>
</div>
</div>
</div></footer><script src="/assets.gentoo.org/tyrian/jquery.min.js"></script><script src="/assets.gentoo.org/tyrian/bootstrap.min.js"></script><script src="/assets.gentoo.org/lunr/lunr.min.js"></script><script>var documentsSrc = "../../documents.js"</script><script src="../../search.js"></script>
</body>
</html>
