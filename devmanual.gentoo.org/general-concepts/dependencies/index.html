<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Dependencies – Gentoo Development Guide</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="The Gentoo Devmanual is a technical manual which covers topics such as writing ebuilds and eclasses, and policies that developers should be abiding by.">
<link href="/assets.gentoo.org/tyrian/bootstrap.min.css" rel="stylesheet" media="screen">
<link href="/assets.gentoo.org/tyrian/tyrian.min.css" rel="stylesheet" media="screen">
<link rel="stylesheet" href="../../devmanual.css" type="text/css">
<link rel="icon" href="/www.gentoo.org/favicon.ico" type="image/x-icon">
</head>
<body>
<header><div class="site-title"><div class="container"><div class="row">
<div class="site-title-buttons"><div class="btn-group btn-group-sm">
<a href="https://get.gentoo.org/" role="button" class="btn get-gentoo"><span class="fa fa-fw fa-download"></span><strong> Get Gentoo!</strong></a><div class="btn-group btn-group-sm">
<a class="btn gentoo-org-sites dropdown-toggle" data-toggle="dropdown" data-target="#" href="index.html#"><span class="fa fa-fw fa-map-o"></span><span class="hidden-xs"> gentoo.org sites </span><span class="caret"></span></a><ul class="dropdown-menu dropdown-menu-right">
<li><a href="https://www.gentoo.org/" title="Main Gentoo website"><span class="fa fa-home fa-fw"></span> gentoo.org</a></li>
<li><a href="https://wiki.gentoo.org/" title="Find and contribute documentation"><span class="fa fa-file-text-o fa-fw"></span> Wiki</a></li>
<li><a href="https://bugs.gentoo.org/" title="Report issues and find common issues"><span class="fa fa-bug fa-fw"></span> Bugs</a></li>
<li><a href="https://forums.gentoo.org/" title="Discuss with the community"><span class="fa fa-comments-o fa-fw"></span> Forums</a></li>
<li><a href="https://packages.gentoo.org/" title="Find software for your Gentoo"><span class="fa fa-hdd-o fa-fw"></span> Packages</a></li>
<li class="divider">
<li><a href="https://planet.gentoo.org/" title="Find out what's going on in the developer community"><span class="fa fa-rss fa-fw"></span> Planet</a></li>
<li><a href="https://archives.gentoo.org/" title="Read up on past discussions"><span class="fa fa-archive fa-fw"></span> Archives</a></li>
<li><a href="https://sources.gentoo.org/" title="Browse our source code"><span class="fa fa-code fa-fw"></span> Sources</a></li>
<li class="divider">
<li><a href="https://infra-status.gentoo.org/" title="Get updates on the services provided by Gentoo"><span class="fa fa-server fa-fw"></span> Infra Status</a></li>
</ul>
</div>
</div></div>
<div>
<a href="../../index.html" title="Back to the homepage" class="site-logo"><object data="/assets.gentoo.org/tyrian/site-logo.svg" type="image/svg+xml"><img src="/assets.gentoo.org/tyrian/site-logo.png" alt="Gentoo Linux Logo"></object></a><span class="site-label">Development Guide</span>
</div>
</div></div></div>
<nav class="tyrian-navbar" role="navigation"><div class="container"><div class="row">
<div class="navbar-header"><button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-main-collapse"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button></div>
<div class="collapse navbar-collapse navbar-main-collapse"><ul class="nav navbar-nav">
<li><a href="../../index.html"><span class="fa fa-home"></span> Home</a></li>
<li class="dropdown">
<a href="index.html#" class="dropdown-toggle" data-toggle="dropdown">Index <span class="caret"></span></a><ul class="dropdown-menu">
<li><a class="reference" href="index.html#dependency-types">Dependency types</a></li>
<li><a class="reference" href="index.html#dependency-syntax">Dependency Syntax</a></li>
<li><a class="reference" href="index.html#tips-for-checking-dependencies">Tips for Checking Dependencies</a></li>
<li><a class="reference" href="index.html#implicit-system-dependency">Implicit System Dependency</a></li>
<li><a class="reference" href="index.html#test-dependencies">Test Dependencies</a></li>
<li><a class="reference" href="index.html#circular-dependencies">Circular Dependencies</a></li>
</ul>
</li>
<li><a class="w-250 text-center" href="../config-protect/index.html"><span class="fa fa-arrow-left"></span><span class="truncated-text d-inline-block max-w-200 ml-2">Configuration File Protection</span></a></li>
<li><a class="w-250 text-center" href="../ebuild-revisions/index.html"><span class="truncated-text d-inline-block max-w-200 mr-2">Ebuild Revisions</span><span class="fa fa-arrow-right"></span></a></li>
</ul></div>
</div></div></nav><nav class="navbar navbar-grey navbar-stick" id="devmanual-actions" role="navigation"><div class="container"><div class="row"><div class="input-group">
<input type="search" name="search" placeholder="Search" title="Search Gentoo Developer Manual [f]" accesskey="f" id="searchInput" class="form-control" onclick="fetchDocuments()"><div class="input-group-btn"><input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton btn btn-default" onclick="search()"></div>
</div></div></div></nav><div id="searchResults" class="modal fade" role="dialog"><div class="modal-dialog"><div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal">x</button><h4 class="modal-title">Search Results</h4>
</div>
<div class="modal-body"><p>No results found.</p></div>
<div class="modal-footer"><button type="button" class="btn btn-default" data-dismiss="modal">Close</button></div>
</div></div></div>
<div class="container"><div class="row"><div class="col-md010"><ol class="breadcrumb">
<li><a href="../../index.html">Master Index</a></li>
<li><a href="../index.html">General Concepts</a></li>
</ol></div></div></div></header><main><div class="container">
<h1 class="first-header">软件包依赖</h1>

<p>
自动解决依赖是 <code class="docutils literal"><span class="pre">emerge</span></code> 最实用的功能之一。
</p>

<div class="section">
<h2 id="dependency-types">依赖的类型</h2>
<div class="section">
<h3 id="chost-vs-cbuild">CHOST 与 CBUILD</h3>

<p>
为了避免歧义，本文使用以下术语指代交叉编译时不同的系统：
</p>

<dl>
  <dt>CBUILD</dt>
  <dd>
    执行编译过程的系统。Dependencies that apply
    to the CBUILD system can be executed during build time.  When
    cross-compiling, they are not installed into the system being built.
  </dd>

  <dt>CHOST</dt>
  <dd>
    将要运行软件包的系统。When
    cross-compiling, dependencies applying to CHOST can not be executed.
  </dd>
</dl>

<p>
如果没有交叉编译，CBUILD 和 CHOST 就是同一个系统，所有类型的依赖都会合并。
</p>

</div>
<div class="section">
<h3 id="build-dependencies">编译时依赖</h3>

<p>
编译时依赖用来指定软件包在解压缩、打补丁、编译、测试和安装过程中的所有依赖（但是有些不用指定，参阅
<a class="" href="index.html#implicit-system-dependency">隐式系统依赖</a>）。
</p>

<p>
从 EAPI 7 开始，编译时依赖被拆分成了 <code class="docutils literal"><span class="pre">BDEPEND</span></code> 和 <code class="docutils literal"><span class="pre">DEPEND</span></code> 两个变量。
<code class="docutils literal"><span class="pre">BDEPEND</span></code> specifies dependencies
applicable to CBUILD, i.e. programs that need to be executed during the build,
e.g. <code class="docutils literal"><span class="pre">virtual/pkgconfig</span></code>. <code class="docutils literal"><span class="pre">DEPEND</span></code> specifies dependencies for CHOST,
i.e. packages that need to be found on built system, e.g. libraries and headers.
</p>

<p>
在更早的 EAPI 中，所有的编译时依赖都放到 <code class="docutils literal"><span class="pre">DEPEND</span></code> 里。
</p>

</div>
<div class="section">
<h3 id="runtime-dependencies">运行时依赖</h3>

<p>
<code class="docutils literal"><span class="pre">RDEPEND</span></code>
变量指定了运行时所需要的依赖。包括库文件（如果是动态链接的）、数据文件以及（对于解释型语言）相关的解释器。
</p>

<p>
注意如果安装的是二进制包，那么将只检查
<code class="docutils literal"><span class="pre">RDEPEND</span></code>。因此有必要将依赖项包含进来，即使它们已经被列在了
<code class="docutils literal"><span class="pre">DEPEND</span></code> 里。
</p>

<p>
Items which are in <code class="docutils literal"><span class="pre">RDEPEND</span></code> but not <code class="docutils literal"><span class="pre">DEPEND</span></code> could <i>in theory</i> be merged
<i>after</i> the target package. Portage does not currently do this.
</p>

</div>
<div class="section">
<h3 id="post-dependencies">Post Dependencies</h3>

<p>
The <code class="docutils literal"><span class="pre">PDEPEND</span></code> variable specifies runtime dependencies that do not strictly
require being satisfied immediately. They can be merged <i>after</i>
the package. This variable is used purely to resolve circular dependencies,
while in general case <code class="docutils literal"><span class="pre">RDEPEND</span></code> should be used instead.
</p>

</div>
</div>
<div class="section">
<h2 id="dependency-syntax">依赖的语法</h2>
<div class="section">
<h3 id="basic-dependency-syntax">依赖的基本语法</h3>

<p>
一个基本的 <code class="docutils literal"><span class="pre">DEPEND</span></code> 规范如下所示：
</p>

<pre><span class="Constant"><span xmlns="http://www.w3.org/1999/xhtml" class="Identifier">DEPEND</span><span xmlns="http://www.w3.org/1999/xhtml" class="Constant">=</span><span xmlns="http://www.w3.org/1999/xhtml" class="Statement">"</span>dev-lang/ruby
	dev-ruby/ruby-gtk2
	dev-ruby/mysql-ruby<span xmlns="http://www.w3.org/1999/xhtml" class="Statement">"</span>
</span></pre>

<p>
每一个<i>依赖项</i>是一个完整的目录和软件包名称。依赖项之间由任意的空格分隔
—— 习惯上为了可读性会把每一个依赖项单独写一行。软件包名称前面的目录不能省略。
</p>

</div>
<div class="section">
<h3 id="version-dependencies">版本依赖</h3>

<p>
有时候软件包会依赖另一个软件包的特定版本。这时就需要指定版本信息，例如：
</p>

<pre><span class="Constant"><span xmlns="http://www.w3.org/1999/xhtml" class="Identifier">DEPEND</span><span xmlns="http://www.w3.org/1999/xhtml" class="Constant">=</span><span xmlns="http://www.w3.org/1999/xhtml" class="Statement">"</span>&gt;=dev-libs/openssl-0.9.7d<span xmlns="http://www.w3.org/1999/xhtml" class="Statement">"</span>
</span></pre>

<p>
这表示需要版本至少是 0.9.7d 的 <code class="docutils literal"><span class="pre">openssl</span></code>。
</p>
<div class="section">
<h4 id="version-specifiers">版本说明符</h4>

<p>
版本说明符有以下几种：
</p>

<table class="table">
  <tr>
    <th>说明符</th>
    <th>含义</th>
  </tr>
  <tr>
    <td><code class="docutils literal"><span class="pre">&gt;=app-misc/foo-1.23</span></code></td>
    <td>需要 1.23 或更新的版本。</td>
  </tr>
  <tr>
    <td><code class="docutils literal"><span class="pre">&gt;app-misc/foo-1.23</span></code></td>
    <td>需要版本号严格大于1.23。</td>
  </tr>
  <tr>
    <td><code class="docutils literal"><span class="pre">~app-misc/foo-1.23</span></code></td>
    <td>需要 1.23 版本，任何一个 <code class="docutils literal"><span class="pre">1.23-r*</span></code> 版本也可以。</td>
  </tr>
  <tr>
    <td><code class="docutils literal"><span class="pre">=app-misc/foo-1.23</span></code></td>
    <td>
      Exactly version 1.23 is required. If at all possible,
      use the <code class="docutils literal"><span class="pre">~</span></code> form to simplify revision bumps.
    </td>
  </tr>
  <tr>
    <td><code class="docutils literal"><span class="pre">&lt;=app-misc/foo-1.23</span></code></td>
    <td>需要 1.23 或更旧的版本。</td>
  </tr>
  <tr>
    <td><code class="docutils literal"><span class="pre">&lt;app-misc/foo-1.23</span></code></td>
    <td>需要版本号严格小于1.23。</td>
  </tr>
</table>

</div>
<div class="section">
<h4 id="ranged-dependencies">范围版本依赖</h4>

<p>
若要依赖“2.x 而不是 1.x 或 3.x 版本”的软件包，就需要使用星号后缀，常见于以下情况：
</p>

<pre><span class="Constant"><span xmlns="http://www.w3.org/1999/xhtml" class="Identifier">DEPEND</span><span xmlns="http://www.w3.org/1999/xhtml" class="Constant">=</span><span xmlns="http://www.w3.org/1999/xhtml" class="Statement">"</span>gtk? <span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">(</span> =x11-libs/gtk+-2* <span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">)</span><span xmlns="http://www.w3.org/1999/xhtml" class="Statement">"</span>
</span></pre>

<p>
注意等号是必须的，而且星号前面没有点。还要注意的是如果你在某个槽里筛选版本，那么插槽依赖也要加上（参阅下文）。
</p>

</div>
<div class="section">
<h4 id="blockers">Blockers</h4>

<p>
When two packages (package slots, versions) can not be installed
simultaneously, blockers can be used to expose such a conflict
to the package manager.
</p>

<p>
There are two kinds of blockers: <i>weak blockers</i> and <i>strong
blockers</i>.
</p>

<p>
A weak blocker is defined using the following syntax:
</p>

<pre><span class="Constant"><span xmlns="http://www.w3.org/1999/xhtml" class="Identifier">RDEPEND</span><span xmlns="http://www.w3.org/1999/xhtml" class="Constant">=</span><span xmlns="http://www.w3.org/1999/xhtml" class="Statement">"</span>!app-misc/foo<span xmlns="http://www.w3.org/1999/xhtml" class="Statement">"</span>
</span></pre>

<p>
The package manager will try to resolve this conflict automatically.
The package blocked by a weak blocker can be uninstalled <i>after</i>
installing the package blocking it. However, it exempts the common
files from file collision checks. Weak blockers are usually used
to solve file collisions between packages and are meaningful only
in <code class="docutils literal"><span class="pre">RDEPEND</span></code>.
</p>

<p>
More specifically, installation of the newer package may overwrite any
colliding files that belong to the older package that is explicitly blocked.
When such file collisions occur, the colliding files cease to belong to the
older package, and they remain installed after the older package is eventually
uninstalled. The older package is uninstalled only after any newer blocking
packages have been merged on top of it.
</p>

<div class="alert alert-danger" role="alert">
<strong>Warning:</strong>
Weak blockers that are pure <code class="docutils literal"><span class="pre">DEPEND</span></code> <i>do not work correctly</i>.
While Portage seemingly queues the package for removal, it <i>does not</i>
exempt their contents from file collision checks. Always include your
weak blockers in <code class="docutils literal"><span class="pre">RDEPEND</span></code>!
</div>

<p>
If it is strictly necessary to resolve the blocker before the package
is built (installed), a strong blocker must be used instead. In this case,
temporary simultaneous installation of the conflicting packages is not allowed.
Strong blockers are expressed using the following syntax:
</p>

<pre><span class="Constant"><span xmlns="http://www.w3.org/1999/xhtml" class="Identifier">RDEPEND</span><span xmlns="http://www.w3.org/1999/xhtml" class="Constant">=</span><span xmlns="http://www.w3.org/1999/xhtml" class="Statement">"</span>!!app-misc/foo<span xmlns="http://www.w3.org/1999/xhtml" class="Statement">"</span>
</span></pre>

<p>
Strong blockers apply accordingly to the dependency type defining them.
Blockers defined in <code class="docutils literal"><span class="pre">RDEPEND</span></code> are enforced as long as the package
is installed (but do not prevent building binary packages). Blockers
defined purely in <code class="docutils literal"><span class="pre">DEPEND</span></code> are enforced only for building
the package from source, and may not apply once the package is installed
or when it is installed from a binary package.
</p>

<div class="alert alert-info" role="alert">
<strong>Note:</strong>
If both weak and strong blockers match a given package, the strong blocker
takes precedence.
</div>

<p>
Specific versions can also be blocked:
</p>

<pre><span class="Constant"><span xmlns="http://www.w3.org/1999/xhtml" class="Identifier">RDEPEND</span><span xmlns="http://www.w3.org/1999/xhtml" class="Constant">=</span><span xmlns="http://www.w3.org/1999/xhtml" class="Statement">"</span>!&lt;app-misc/foo-1.3<span xmlns="http://www.w3.org/1999/xhtml" class="Statement">"</span>
</span></pre>

<p>
Blockers can be optional based upon <code class="docutils literal"><span class="pre">USE</span></code> flags as per normal
dependencies.
</p>

<p>
Blockers added to older ebuilds should not be expected to be retroactive.  If
the user already has the ebuild installed, any changes to the ebuild should not
be expected to make any difference.  This means that you should add the
blockers to whichever ebuild is the newest (even if it means that logically it
would seem backwards).  For example, certain versions of portage don't like
some versions of bash, but the blocker was put into bash because that was the
newer package that caused the issues.
</p>

</div>
</div>
<div class="section">
<h3 id="slot-dependencies">SLOT Dependencies</h3>

<p>
To depend on a specific <code class="docutils literal"><span class="pre">SLOT</span></code>, <code class="docutils literal"><span class="pre">:SLOT</span></code> should be appended to
the package name, where 'SLOT' is the <code class="docutils literal"><span class="pre">SLOT</span></code> of the package wanted:
</p>

<pre><span class="Constant"><span xmlns="http://www.w3.org/1999/xhtml" class="Identifier">DEPEND</span><span xmlns="http://www.w3.org/1999/xhtml" class="Constant">=</span><span xmlns="http://www.w3.org/1999/xhtml" class="Statement">"</span>qt3? <span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">(</span> x11-libs/qt:3 <span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">)</span>
	gtk? <span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">(</span> x11-libs/gtk+:2 <span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">)</span>
</span></pre>

<p>
To depend on a specific version or version-range within a SLOT we use:
</p>

<pre><span class="Constant"><span xmlns="http://www.w3.org/1999/xhtml" class="Identifier">DEPEND</span><span xmlns="http://www.w3.org/1999/xhtml" class="Constant">=</span><span xmlns="http://www.w3.org/1999/xhtml" class="Statement">"</span>qt3? <span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">(</span> ~x11-libs/qt-3.3.8:3 <span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">)</span>
	gtk? <span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">(</span> <span xmlns="http://www.w3.org/1999/xhtml" class="Identifier">&gt;</span><span xmlns="http://www.w3.org/1999/xhtml" class="Constant">=</span>x11-libs/gtk+-2.24.9:2 <span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">)</span>
</span></pre>
<div class="section">
<h4 id="slot-operators">Slot Operators</h4>

<p>
In <code class="docutils literal"><span class="pre">EAPI=5</span></code> and higher, you can use slot operators appended to the package
name to declare whether or not your package should be rebuilt after the versions
satisfying its runtime dependencies are updated to versions with a different slot
or <a class="" href="../slotting/index.html#sub-slots">sub-slot</a>:
</p>

<ul>
  <li>
<code class="docutils literal"><span class="pre">:=</span></code> means that any slot is acceptable, and that your package should be
  rebuilt if the version best matching the runtime dependency is updated to a
  version with a different slot or subslot;</li>
  <li>
<code class="docutils literal"><span class="pre">:*</span></code> means that any slot is acceptable, and explicitly declares that
  changes in the slot or sub-slot can be ignored;</li>
  <li>
<code class="docutils literal"><span class="pre">:SLOT=</span></code> means that only the 'SLOT' slot is acceptable, and that your
  package should be rebuilt if the version matching the runtime dependency is
  updated to another version with this slot but with a different subslot;</li>
  <li>
<code class="docutils literal"><span class="pre">:SLOT</span></code> means that only the 'SLOT' slot is acceptable, and that changes
  in the sub-slot can be ignored (like in previous EAPIs).</li>
  <li>
<code class="docutils literal"><span class="pre">:SLOT/SUBSLOT</span></code> means a dependency on a specific slot and sub-slot pair,
  which can be useful for packages installing pre-built binaries that require a
  library with a particular soname version corresponding to the sub-slot.</li>
</ul>

<p>
For example:
</p>

<pre><span class="Constant"><span xmlns="http://www.w3.org/1999/xhtml" class="Identifier">RDEPEND</span><span xmlns="http://www.w3.org/1999/xhtml" class="Constant">=</span><span xmlns="http://www.w3.org/1999/xhtml" class="Statement">"</span>media-libs/cogl:1.0=
	gnutls? <span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">(</span> <span xmlns="http://www.w3.org/1999/xhtml" class="Identifier">&gt;</span><span xmlns="http://www.w3.org/1999/xhtml" class="Constant">=</span>net-libs/gnutls-2.8:= <span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">)</span><span xmlns="http://www.w3.org/1999/xhtml" class="Statement">"</span>
</span></pre>

</div>
</div>
<div class="section">
<h3 id="use-conditional-dependencies">USE-Conditional Dependencies</h3>

<p>
To depend upon a certain package if and only if a given <code class="docutils literal"><span class="pre">USE</span></code> flag is set:
</p>

<pre><span class="Constant"><span xmlns="http://www.w3.org/1999/xhtml" class="Identifier">DEPEND</span><span xmlns="http://www.w3.org/1999/xhtml" class="Constant">=</span><span xmlns="http://www.w3.org/1999/xhtml" class="Statement">"</span>perl? <span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">(</span> dev-lang/perl <span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">)</span>
	ruby? <span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">(</span> <span xmlns="http://www.w3.org/1999/xhtml" class="Identifier">&gt;</span><span xmlns="http://www.w3.org/1999/xhtml" class="Constant">=</span>dev-lang/ruby-1.8 <span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">)</span>
	python? <span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">(</span> dev-lang/python <span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">)</span><span xmlns="http://www.w3.org/1999/xhtml" class="Statement">"</span>
</span></pre>

<p>
It is also possible to depend upon a certain package if a given <code class="docutils literal"><span class="pre">USE</span></code> flag is
<i>not</i> set:
</p>

<pre><span class="Constant"><span xmlns="http://www.w3.org/1999/xhtml" class="Identifier">RDEPEND</span><span xmlns="http://www.w3.org/1999/xhtml" class="Constant">=</span><span xmlns="http://www.w3.org/1999/xhtml" class="Statement">"</span>!crypt? <span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">(</span> net-misc/netkit-rsh <span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">)</span><span xmlns="http://www.w3.org/1999/xhtml" class="Statement">"</span>
</span></pre>

<p>
This should <b>not</b> be used for disabling a certain <code class="docutils literal"><span class="pre">USE</span></code> flag on a given
architecture. In order to do this, the architecture team should add the <code class="docutils literal"><span class="pre">USE</span></code>
flag to their <code class="docutils literal"><span class="pre">use.mask</span></code> file in the <code class="docutils literal"><span class="pre">profiles/arch</span></code>
directory of the Gentoo repository.
</p>

<p>
This can be nested:
</p>

<pre><span class="Constant"><span xmlns="http://www.w3.org/1999/xhtml" class="Identifier">DEPEND</span><span xmlns="http://www.w3.org/1999/xhtml" class="Constant">=</span><span xmlns="http://www.w3.org/1999/xhtml" class="Statement">"</span>!build? <span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">(</span>
	gcj? <span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">(</span>
		gtk? <span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">(</span>
			x11-libs/libXt
			x11-libs/libX11
			x11-libs/libXtst
			x11-proto/xproto
			x11-proto/xextproto
			<span xmlns="http://www.w3.org/1999/xhtml" class="Identifier">&gt;</span><span xmlns="http://www.w3.org/1999/xhtml" class="Constant">=</span>x11-libs/gtk+-2.2
			x11-libs/pango
		<span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">)</span>
		<span xmlns="http://www.w3.org/1999/xhtml" class="Identifier">&gt;</span><span xmlns="http://www.w3.org/1999/xhtml" class="Constant">=</span>media-libs/libart_lgpl-2.1
	<span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">)</span>
	<span xmlns="http://www.w3.org/1999/xhtml" class="Identifier">&gt;</span><span xmlns="http://www.w3.org/1999/xhtml" class="Constant">=</span>sys-libs/ncurses-5.2-r2
	nls? <span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">(</span> sys-devel/gettext <span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">)</span>
<span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">)</span><span xmlns="http://www.w3.org/1999/xhtml" class="Statement">"</span>
</span></pre>

</div>
<div class="section">
<h3 id="any-of-many-dependencies">Any of Many Dependencies</h3>

<p>
To depend on either <code class="docutils literal"><span class="pre">foo</span></code> or <code class="docutils literal"><span class="pre">bar</span></code>:
</p>

<pre><span class="Constant"><span xmlns="http://www.w3.org/1999/xhtml" class="Identifier">DEPEND</span><span xmlns="http://www.w3.org/1999/xhtml" class="Constant">=</span><span xmlns="http://www.w3.org/1999/xhtml" class="Statement">"</span>|| <span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">(</span> app-misc/foo app-misc/bar <span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">)</span><span xmlns="http://www.w3.org/1999/xhtml" class="Statement">"</span>
</span></pre>

<p>
To depend on either <code class="docutils literal"><span class="pre">foo</span></code> or <code class="docutils literal"><span class="pre">bar</span></code> if the <code class="docutils literal"><span class="pre">baz</span></code> <code class="docutils literal"><span class="pre">USE</span></code> flag is set:
</p>

<pre><span class="Constant"><span xmlns="http://www.w3.org/1999/xhtml" class="Identifier">DEPEND</span><span xmlns="http://www.w3.org/1999/xhtml" class="Constant">=</span><span xmlns="http://www.w3.org/1999/xhtml" class="Statement">"</span>baz? <span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">(</span> || <span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">(</span> app-misc/foo app-misc/bar <span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">)</span> <span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">)</span><span xmlns="http://www.w3.org/1999/xhtml" class="Statement">"</span>
</span></pre>
<div class="section">
<h4 id="any-of-many-versus-use">Any of Many Versus USE</h4>

<p>
Say <code class="docutils literal"><span class="pre">fnord</span></code> can be built against either <code class="docutils literal"><span class="pre">foo</span></code> or <code class="docutils literal"><span class="pre">bar</span></code>. Then a <code class="docutils literal"><span class="pre">USE</span></code>
flag is not necessary if and only if all of the following hold:
</p>

<ul>
  <li>
    <code class="docutils literal"><span class="pre">fnord</span></code> is merged on a system which has <code class="docutils literal"><span class="pre">foo</span></code> and not <code class="docutils literal"><span class="pre">bar</span></code> installed.
    <code class="docutils literal"><span class="pre">foo</span></code> is then unmerged, and <code class="docutils literal"><span class="pre">bar</span></code> is installed. <code class="docutils literal"><span class="pre">fnord</span></code> must continue to
    work correctly.
  </li>
  <li>
    A binary package of <code class="docutils literal"><span class="pre">fnord</span></code> made on a system with <code class="docutils literal"><span class="pre">foo</span></code> and not <code class="docutils literal"><span class="pre">bar</span></code>
    can be taken and installed on a system with <code class="docutils literal"><span class="pre">bar</span></code> and not <code class="docutils literal"><span class="pre">foo</span></code>.
  </li>
</ul>

</div>
</div>
<div class="section">
<h3 id="built-with-use-dependencies">Built with USE Dependencies</h3>

<p>
Available specifiers are:
</p>

<table class="table">
  <tr>
    <th>Specifier</th>
    <th>Meaning</th>
  </tr>
  <tr>
    <td><code class="docutils literal"><span class="pre">app-misc/foo[bar]</span></code></td>
    <td>foo must have bar enabled.</td>
  </tr>
  <tr>
    <td><code class="docutils literal"><span class="pre">app-misc/foo[bar,baz]</span></code></td>
    <td>foo must have both bar and baz enabled.</td>
  </tr>
  <tr>
    <td><code class="docutils literal"><span class="pre">app-misc/foo[-bar,baz]</span></code></td>
    <td>foo must have bar disabled and baz enabled.</td>
  </tr>
</table>

<p>
There are also shortcuts for conditional situations:
</p>

<table class="table">
  <tr>
    <th>Compact form</th>
    <th>Equivalent expanded form</th>
  </tr>
  <tr>
    <td><code class="docutils literal"><span class="pre">app-misc/foo[bar?]</span></code></td>
    <td><code class="docutils literal"><span class="pre">bar? ( app-misc/foo[bar] ) !bar? ( app-misc/foo )</span></code></td>
  </tr>
  <tr>
    <td><code class="docutils literal"><span class="pre">app-misc/foo[!bar?]</span></code></td>
    <td><code class="docutils literal"><span class="pre">bar? ( app-misc/foo ) !bar? ( app-misc/foo[-bar] )</span></code></td>
  </tr>
  <tr>
    <td><code class="docutils literal"><span class="pre">app-misc/foo[bar=]</span></code></td>
    <td><code class="docutils literal"><span class="pre">bar? ( app-misc/foo[bar] ) !bar? ( app-misc/foo[-bar] )</span></code></td>
  </tr>
  <tr>
    <td><code class="docutils literal"><span class="pre">app-misc/foo[!bar=]</span></code></td>
    <td><code class="docutils literal"><span class="pre">bar? ( app-misc/foo[-bar] ) !bar? ( app-misc/foo[bar] )</span></code></td>
  </tr>
</table>
<div class="section">
<h4 id="use-dependency-defaults">Use dependency defaults</h4>

<p>
If a dependency is introducing or removing a <code class="docutils literal"><span class="pre">USE</span></code> flag in a new package
version, a <code class="docutils literal"><span class="pre">(+)</span></code> or <code class="docutils literal"><span class="pre">(-)</span></code> may be added to the use-dependency
specification to define a default value in case the flag does not exist in the
target package. The <code class="docutils literal"><span class="pre">(+)</span></code> indicates that the missing flag is assumed to be
enabled, <code class="docutils literal"><span class="pre">(-)</span></code> the opposite.
</p>

<p>
For example, the following will treat all <code class="docutils literal"><span class="pre">boost</span></code> versions without the
<code class="docutils literal"><span class="pre">threads</span></code> flag as having it enabled, and all <code class="docutils literal"><span class="pre">gcc</span></code> versions without
the <code class="docutils literal"><span class="pre">openmp</span></code> as having it disabled:
</p>

<pre><span class="Constant"><span xmlns="http://www.w3.org/1999/xhtml" class="Identifier">DEPEND</span><span xmlns="http://www.w3.org/1999/xhtml" class="Constant">=</span><span xmlns="http://www.w3.org/1999/xhtml" class="Statement">"</span>
	<span xmlns="http://www.w3.org/1999/xhtml" class="Identifier">&gt;</span><span xmlns="http://www.w3.org/1999/xhtml" class="Constant">=</span>dev-libs/boost-1.48[threads(+)]
	sys-devel/gcc[openmp(-)]<span xmlns="http://www.w3.org/1999/xhtml" class="Statement">"</span>
</span></pre>

</div>
</div>
</div>
<div class="section">
<h2 id="tips-for-checking-dependencies">Tips for Checking Dependencies</h2>

<p>
It is important to ensure that all the dependencies are complete for your
package:
</p>

<dl>
  <dt>Look at installed binaries/libraries</dt>
  <dd>
    Use a tool like <code class="docutils literal"><span class="pre">scanelf -n</span></code> (from app-misc/pax-utils) or
    <code class="docutils literal"><span class="pre">objdump -p</span></code> (from sys-devel/binutils) to list <code class="docutils literal"><span class="pre">DT_NEEDED</span></code>
    entries
  </dd>
  <dt>Look in <code class="docutils literal"><span class="pre">configure.ac</span></code>
</dt>
  <dd>
    Look for checks for packages in here. Things to look out for are pkg-config
    checks or <code class="docutils literal"><span class="pre">AM_*</span></code> functions that check for a specific version.
  </dd>
  <dt>Look at included <code class="docutils literal"><span class="pre">.spec</span></code> files</dt>
  <dd>
    A good indication of dependencies is to look at the included <code class="docutils literal"><span class="pre">.spec</span></code>
    files for relevant deps. However, do not trust them to be the definitive
    complete list of dependencies.
  </dd>
  <dt>Look at the application/library website</dt>
  <dd>
    Check the application website for possible dependencies that they suggest
    are needed
  </dd>
  <dt>Read the <code class="docutils literal"><span class="pre">README</span></code> and <code class="docutils literal"><span class="pre">INSTALL</span></code> for the package</dt>
  <dd>
    They usually also contain useful information about building and installing
    packages
  </dd>
  <dt>
    Remember non-binary dependencies such as pkg-config, doc generation
    programs, etc.
  </dt>
  <dd>
    Usually the build process requires some dependencies such as intltool,
    libtool, pkg-config, doxygen, scrollkeeper, gtk-doc, etc. Make sure those
    are clearly stated.
  </dd>
</dl>

</div>
<div class="section">
<h2 id="implicit-system-dependency">Implicit System Dependency</h2>

<p>
All packages have an implicit compile-time and runtime dependency upon the
entire <code class="docutils literal"><span class="pre">@system</span></code> set. It is therefore not necessary, nor advisable, to
specify dependencies upon toolchain packages like <code class="docutils literal"><span class="pre">gcc</span></code>, <code class="docutils literal"><span class="pre">libc</span></code> and
so on, except where specific versions or packages (for example, <code class="docutils literal"><span class="pre">glibc</span></code>
over <code class="docutils literal"><span class="pre">uclibc</span></code>) are required. Note that this rule also needs consideration
for packages like <code class="docutils literal"><span class="pre">flex</span></code>, <code class="docutils literal"><span class="pre">zlib</span></code> and <code class="docutils literal"><span class="pre">libtool</span></code>, which aren't in
the <code class="docutils literal"><span class="pre">@system</span></code> set for every profile. For example, the embedded profile
doesn't have <code class="docutils literal"><span class="pre">zlib</span></code> in <code class="docutils literal"><span class="pre">@system</span></code>, the <code class="docutils literal"><span class="pre">libtool</span></code> ABI might
change and break building order and <code class="docutils literal"><span class="pre">flex</span></code> might get removed from the
<code class="docutils literal"><span class="pre">@system</span></code> set in future.
</p>

<p>
However, packages which are included in the <code class="docutils literal"><span class="pre">@system</span></code> set, or are
dependencies of <code class="docutils literal"><span class="pre">@system</span></code> set packages, should generally include
a complete dependency list (excluding bootstrap packages). This makes
<code class="docutils literal"><span class="pre">emerge -e @system</span></code> possible when installing from a stage 1 or stage 2
tarball.
</p>

</div>
<div class="section">
<h2 id="test-dependencies">Test Dependencies</h2>

<p>
Packages often have optional dependencies that are needed only when running
tests. These should be specified in DEPEND behind a USE flag. Often, the
'test' USE flag is used for this purpose.
</p>

<p>
Since testing will likely fail when test dependencies are not installed, the
test phase should be disabled in this case. This may be accomplished via USE
conditionals in the RESTRICT variable.
</p>

<p>
If other optional features must be enabled/disabled when testing, REQUIRED_USE
may be set to express this.
</p>

<pre><span class="Constant"><span xmlns="http://www.w3.org/1999/xhtml" class="Comment">#</span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment"> </span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment">Define</span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment"> </span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment">some</span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment"> </span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment">USE</span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment"> </span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment">flags</span>
<span xmlns="http://www.w3.org/1999/xhtml" class="Identifier">IUSE</span><span xmlns="http://www.w3.org/1999/xhtml" class="Constant">=</span><span xmlns="http://www.w3.org/1999/xhtml" class="Statement">"</span>debug test<span xmlns="http://www.w3.org/1999/xhtml" class="Statement">"</span>

<span xmlns="http://www.w3.org/1999/xhtml" class="Comment">#</span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment"> </span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment">Require</span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment"> </span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment">debug</span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment"> </span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment">support</span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment"> </span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment">when</span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment"> </span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment">tests</span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment"> </span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment">are</span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment"> </span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment">enabled</span>
<span xmlns="http://www.w3.org/1999/xhtml" class="Identifier">REQUIRED_USE</span><span xmlns="http://www.w3.org/1999/xhtml" class="Constant">=</span><span xmlns="http://www.w3.org/1999/xhtml" class="Statement">"</span>test? <span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">(</span> debug <span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">)</span><span xmlns="http://www.w3.org/1999/xhtml" class="Statement">"</span>

<span xmlns="http://www.w3.org/1999/xhtml" class="Comment">#</span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment"> </span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment">Disable</span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment"> </span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment">test</span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment"> </span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment">phase</span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment"> </span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment">when</span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment"> </span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment">test</span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment"> </span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment">USE</span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment"> </span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment">flag</span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment"> </span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment">is</span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment"> </span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment">disabled</span>
<span xmlns="http://www.w3.org/1999/xhtml" class="Identifier">RESTRICT</span><span xmlns="http://www.w3.org/1999/xhtml" class="Constant">=</span><span xmlns="http://www.w3.org/1999/xhtml" class="Statement">"</span>!test? <span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">(</span> test <span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">)</span><span xmlns="http://www.w3.org/1999/xhtml" class="Statement">"</span>

<span xmlns="http://www.w3.org/1999/xhtml" class="Comment">#</span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment"> </span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment">Running</span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment"> </span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment">tests</span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment"> </span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment">requires</span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment"> </span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment">'foo'</span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment"> </span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment">to</span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment"> </span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment">be</span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment"> </span><span xmlns="http://www.w3.org/1999/xhtml" class="Comment">installed</span>
<span xmlns="http://www.w3.org/1999/xhtml" class="Identifier">DEPEND</span><span xmlns="http://www.w3.org/1999/xhtml" class="Constant">=</span><span xmlns="http://www.w3.org/1999/xhtml" class="Statement">"</span>test? <span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">(</span> dev-util/foo <span xmlns="http://www.w3.org/1999/xhtml" class="PreProc">)</span><span xmlns="http://www.w3.org/1999/xhtml" class="Statement">"</span>
</span></pre>

</div>
<div class="section">
<h2 id="circular-dependencies">Circular Dependencies</h2>

<p>
Circular dependencies occur if one or more of package's (possibly indirect)
dependencies depend on the package itself. This creates a dependency cycle where
each of the packages must technically be installed before the other.
For example, if package A depends on B, B depends on C and C depends on A, then
the package manager cannot install A before C, and C before A.
</p>

<p>
There are three kinds of circular dependencies:
</p>

<ol>
  <li>
    Circular dependencies that occur if only one of the packages strictly needs
    to be installed before the other. For example, <code class="docutils literal"><span class="pre">dev-python/certifi</span></code>
    strictly requires <code class="docutils literal"><span class="pre">dev-python/setuptools</span></code> to build but the latter
    package requires the former for some runtime functionality. As a result,
    <code class="docutils literal"><span class="pre">dev-python/certifi</span></code> can be installed later than the other package.
    <code class="docutils literal"><span class="pre">PDEPEND</span></code> is used to express this and automatically resolve
    the circular dependency.
  </li>

  <li>
    Circular dependencies that occur if the cycle applies only to some
    combination of USE flags on one of the packages. For example, running tests
    in <code class="docutils literal"><span class="pre">dev-python/setuptools</span></code> requires a number of packages which require
    <code class="docutils literal"><span class="pre">dev-python/setuptools</span></code> to be installed first. This kind of circular
    dependency can be resolved by the user by adjusting USE flags on one
    of the packages, e.g. by disabling tests on <code class="docutils literal"><span class="pre">dev-python/setuptools</span></code>,
    and reenabling them once the dependency is initially installed.
  </li>

  <li>
    Circular dependencies that cannot be resolved using the regular means.
    For example, <code class="docutils literal"><span class="pre">dev-util/cmake</span></code> used to depend
    on <code class="docutils literal"><span class="pre">dev-libs/jsoncpp</span></code>, while the latter package used the former
    to build. Resolving this kind of dependency usually requires bundling one
    of the dependencies conditionally, or providing an alternate bootstrap path.
  </li>
</ol>

</div>
</div></main><footer><div class="container">
<div class="row">
<div class="col-xs-12 col-md-offset-2 col-md-7"></div>
<div class="col-xs-12 col-md-3">
<h3 class="footerhead">Questions or comments?</h3>
                Please feel free to <a href="https://www.gentoo.org/inside-gentoo/contact/">contact us</a>.
              </div>
</div>
<div class="row">
<div class="col-xs-2 col-sm-3 col-md-2"><ul class="footerlinks three-icons">
<li><a href="https://twitter.com/gentoo" title="@Gentoo on Twitter"><span class="fa fa-twitter fa-fw"></span></a></li>
<li><a href="https://www.facebook.com/gentoo.org" title="Gentoo on Facebook"><span class="fa fa-facebook fa-fw"></span></a></li>
</ul></div>
<div class="col-xs-10 col-sm-9 col-md-10">
<strong>Copyright (C) 2001-2021 Gentoo Authors</strong><br><small>
                Gentoo is a trademark of the Gentoo Foundation, Inc.
                The text of this document is distributed under the
                <a href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.
                The <a href="https://www.gentoo.org/inside-gentoo/foundation/name-logo-guidelines.html">Gentoo Name and Logo Usage Guidelines</a> apply.
              </small>
</div>
</div>
</div></footer><script src="/assets.gentoo.org/tyrian/jquery.min.js"></script><script src="/assets.gentoo.org/tyrian/bootstrap.min.js"></script><script src="/assets.gentoo.org/lunr/lunr.min.js"></script><script>var documentsSrc = "../../documents.js"</script><script src="../../search.js"></script>
</body>
</html>
